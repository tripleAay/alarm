<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayDaddie Dashboard</title>
    <link rel="stylesheet" href="./css/app.css">
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-storage-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', sans-serif;
    }

    body {
        background-color: #f3f4f6;
        color: #333;
    }

    /* Hide animations on mobile */
    @media (max-width: 768px) {
        .sticky-animation {
            display: none;
        }
    }
</style>

<body>
    <div id="dashboard" class="dashboard min-h-screen bg-gray-50">
        <!-- Only display animation on iPad and Desktop view -->
        <div class="sticky-animation hidden md:block">
            <iframe src="https://lottie.host/embed/e2d9183f-9d09-4f4e-bf4a-7dc1b19737b8/8d7uhe3lZq.json" width="300"
                height="300" frameborder="0" allowfullscreen></iframe>
        </div>

        <!-- Profile Page - Tailwind CSS -->
        <div class="py-10">
            <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-8">
                <!-- Back Button -->
                <button onclick="history.back()"
                    class="mb-6 bg-gray-500 text-white px-4 py-2 rounded-lg shadow hover:bg-gray-600">
                    Back
                </button>

                <!-- Profile Picture Upload -->
                <div class="flex items-center justify-center mb-8">
                    <div class="relative">
                        <img id="profileImagePreview" src="https://via.placeholder.com/150" alt="Profile"
                            class="w-32 h-32 rounded-full object-cover border-4 border-purple-500 shadow-lg">
                        <input type="file" id="profilePic"
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                            onchange="previewImage(event)">
                    </div>
                    <div class="ml-4">
                        <h2 class="text-xl font-semibold text-gray-800">Upload Profile Picture</h2>
                        <p class="text-sm text-gray-500">Click to select and upload a new profile image</p>
                        <button id="uploadButton"
                            class="mt-2 bg-purple-600 text-white px-4 py-2 rounded-lg shadow hover:bg-purple-700">
                            Upload Image
                        </button>
                    </div>
                </div>

                <!-- Personal Information Section -->
                <h3 class="text-lg font-bold text-purple-700 mb-6">Personal Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- First Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">First Name</label>
                        <div id="user-firstname"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>

                    <!-- Last Name -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Last Name</label>
                        <div id="user-lastname"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>

                    <!-- Account Number -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Account Number</label>
                        <div id="user-account"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>

                    <!-- Phone Number -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                        <div id="user-phone"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email</label>
                        <div id="user-email"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>

                    <!-- BVN -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">BVN</label>
                        <div id="user-bvn"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>

                    <!-- Address -->
                    <div class="col-span-2">
                        <label class="block text-sm font-medium text-gray-700">Address</label>
                        <div id="user-address"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>

                    <!-- Country -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Country</label>
                        <div id="user-country"
                            class="mt-1 block w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm p-2"></div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="mt-8 text-right">
                    <button class="bg-purple-600 text-white px-6 py-2 rounded-lg shadow-lg hover:bg-purple-700">
                        Edit Profile
                    </button>
                </div>
            </div>
        </div>




        <!-- TailwindCSS CDN -->

    </div>


    <button id="signout-button"
        class="fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-red-600">
        Sign Out
    </button>

</body>

</html>
<script src="https://cdn.tailwindcss.com"></script>
<script src="./js/script.js"></script>

<script>
    const signoutButton = document.getElementById("signout-button");
    signoutButton.addEventListener('click', (e) => {
        e.preventDefault();
        firebase.auth().signOut()
            .then(() => {
                alert("Signout Successful")
                window.location.href = "./signin.html";
            })
            .catch(() => {
                alert("signout error")
            })
    });
</script>
<script>
    function users() {
        // Retrieve the currentUser data from localStorage
        const currentUserData = localStorage.getItem('currentUser');

        if (!currentUserData) {
            console.log("No user ID found in localStorage.");
            window.location.href = 'login.html'; // Redirect to login if no user is stored
            return; // Exit if no currentUserData is found
        }

        const { uid } = JSON.parse(currentUserData); // Parse and extract the UID from the stored data

        // Reference the Firestore document using the UID
        const docRef = db.collection("users").doc(uid);

        docRef.get().then((doc) => {
            if (doc.exists) {
                console.log("Document data:", doc.data());
                const userData = doc.data();

                // Update UI elements with data from the Firestore document
                document.getElementById("user-firstname").innerText = userData.firstname || "N/A";
                document.getElementById("user-lastname").innerText = userData.lastname || "N/A";
                document.getElementById("user-address").innerText = userData.address || "N/A";
                document.getElementById("user-bvn").innerText = userData.bvn || "N/A";
                document.getElementById("user-phone").innerText = userData.phone || "N/A";
                document.getElementById("user-email").innerText = userData.email || "N/A";
                document.getElementById("user-country").innerText = userData.country || "N/A";
                document.getElementById("user-account").innerText = userData.account || "N/A";
            } else {
                console.log("No such document!");
                alert("No user data found in Firestore.");
            }
        }).catch((error) => {
            console.log("Error getting document:", error);
        });
    }

    // Call the users function to fetch and display the user data
    window.onload = function () {
        users();
    };

</script>


<script>
    // Firebase initialization (you must initialize Firebase in your project with config)

// Function to preview the image
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function () {
        const output = document.getElementById('profileImagePreview');
        output.src = reader.result;
        output.style.display = 'block'; // Show the image preview
    };
    reader.readAsDataURL(event.target.files[0]);
}

// Upload the image to Firebase Storage
document.getElementById('uploadButton').addEventListener('click', function () {
    const file = document.getElementById('profilePic').files[0];
    const currentUserData = JSON.parse(localStorage.getItem('currentUser'));

    if (!currentUserData || !currentUserData.uid) {
        alert('User not authenticated');
        return;
    }

    if (file) {
        // Firebase Storage reference (replace 'your-firebase-app' with your Firebase app details)
        const storageRef = firebase.storage().ref('profile_images/' + currentUserData.uid + '/' + file.name);

        // Upload the image
        const uploadTask = storageRef.put(file);

        uploadTask.on('state_changed', 
            function progress(snapshot) {
                // Optionally: Track the progress of the upload
                const percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                console.log('Upload is ' + percentage + '% done');
            },
            function error(err) {
                // Handle upload error
                console.error('Upload failed:', err);
                alert('Image upload failed');
            },
            function complete() {
                // Get the download URL after the upload completes
                uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL) {
                    alert('Upload successful!');

                    // Store the image URL in localStorage (or Firebase Firestore if needed)
                    currentUserData.profileImage = downloadURL;
                    localStorage.setItem('currentUser', JSON.stringify(currentUserData));

                    // Display the uploaded image
                    const output = document.getElementById('profileImagePreview');
                    output.src = downloadURL;
                    output.style.display = 'block';
                });
            }
        );
    } else {
        alert('No file selected');
    }
});

</script>


